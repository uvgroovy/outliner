<html>

<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
<script src="svg.js"></script>
<script>
SIZE = 6.25;
CANVAS_SIZE = 800;
function drawAngles(draw, angles) {

    // https://github.com/wout/svg.js
    for (var i = 0; i < angles.length; i++) {
        angle = angles[i]["angle"];

        setDebugInfo(angles[i])
        
        var angleRad = Math.PI*angle/180;
        var x = lastX + SIZE * Math.cos(angleRad);
        var y = lastY + SIZE * Math.sin(angleRad);
        //Do something
        draw.line(lastX, lastY, x, y).stroke({ width: 1 })
        lastX = x;
        lastY = y;
    }
}

var clicks = 0;

function setDebugInfo(data) {
    clicks += 1;
    angle = data["angle"];
    mag = data["mag"];
    accel = data["accel"];
    
    $("#clicks").text(clicks);
    $("#angle").text(angle);
    $("#mx").text(mag[0]);
    $("#my").text(mag[1]);
    $("#mz").text(mag[2]);
    $("#ax").text(accel[0]);
    $("#ay").text(accel[1]);
    $("#az").text(accel[2]);
}
</script>




</head>
<body>
The outline drawer!!
Here you go!
<span id="captureindicator" style="visibility:hidden;color:green" >We are capturing</span>
<div >
<ul>
<li>Clicks: <span id="clicks"></span>
</li>
<li>Angle: <span id="angle"></span>
</li>

<li>mx: <span id="mx"></span>
</li>

<li>my: <span id="my"></span>
</li>

<li>mz: <span id="mz"></span>
</li>

<li>ax: <span id="ax"></span>
</li>

<li>ay: <span id="ay"></span>
</li>

<li>az: <span id="az"></span>
</li>

</ul>
</div>
<div id="drawingcanvas">
</div>

<script>

// drawAngles([0,90,90*2,90*3])
function doAjaxOnce(onNewData) {
    return $.ajax({
      url: "/angles",
    type: "GET",
    dataType: "json",
    success: function (data) {
        if (data.length > 0) {
            onNewData(data);
        }
    }
    });
}
function doAjax(onNewData) {
    doAjaxOnce(onNewData).done(function() {
        doAjax(onNewData);
    });

}
// empty server Q
doAjaxOnce(function(x){});
// prepare

var lastX = CANVAS_SIZE/2;
var lastY = CANVAS_SIZE/2;

var draw = SVG('drawingcanvas').size(CANVAS_SIZE, CANVAS_SIZE)
    
// draw
doAjax(function(angles){drawAngles(draw, angles)});
$("#captureindicator").css("visibility", "visible");

</script>
</body>

</html>

